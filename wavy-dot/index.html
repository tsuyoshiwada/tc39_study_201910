<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta name="theme-color" content="#3498db"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Wavy Dot - #tc39_study TC39 Proposals LT 大会</title><meta property="og:title" content="Wavy Dot - #tc39_study TC39 Proposals LT 大会"><meta property="og:type" content="article"><meta property="og:image" content="https://github.com/tsuyoshiwada/tc39_study_201910/raw/master/docs/images/ogp.jpg"><link href="vendor.6.5ad5f6b238180a494f21.css" rel="stylesheet"><link href="main.3.0295305ca86053c4e9a8.css" rel="stylesheet"></head><body><div id="root"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="btn-sidebar" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg><article id="webslides"><section class="aligncenter fullscreen title"><div class="wrap"><div class="content-left"><h1>Wavy Dot</h1><p class="text-intro">Syntactic Support for Promise Pipelining</p><ul class="description"><li><strong>Stage</strong>:<!-- --> 1</li><li><strong>Repository</strong>:<!-- --> <a href="https://github.com/tc39-transfer/proposal-wavy-dot" target="_blank" rel="noopener noreferrer">tc39-transfer/proposal-wavy-dot</a></li><li><strong>Date</strong>: 2019/10/09</li><li><strong>#tc39_study</strong>: TC39 Proposals LT 大会</li></ul></div></div></section><section class="aligncenter about"><div class="wrap"><div class="cta"><div class="number"><img src="https://avatars0.githubusercontent.com/u/5393238?s=460&amp;v=4" width="200" height="200"></div><div class="benefit"><p class="text-subtitle">About me</p><h3>わだまる / tsuyoshiwada</h3><p class="text-intro">Web Developer (CyberAgent CATS).<br>GitHub:<!-- --> <a href="https://github.com/tsuyoshiwada" target="_blank" rel="noopener noreferrer">tsuyoshiwada</a>, Twitter:<!-- --> <a href="https://twitter.com/wadackel" target="_blank" rel="noopener noreferrer">@wadackel</a></p></div></div></div></section><section class="aligncenter current"><h2>Wavy Dot とは ?</h2><p>Pleasant Notation for Promise Pipelining<br><!-- -->Promise Pipelining に対する糖衣構文の提供</p></section><section class="aligncenter"><h2>Promise Pipelining 🤔 ?</h2></section><section class="aligncenter"><p><em>やや主題から外れるためざっくりと...</em></p><p>リモートオブジェクトに対する操作の呼び出しをパイプライン化することが目的。</p><p><code>Promise</code> のみ使う場合と異なり、非同期で受け取る値が返ってくる前に、<br><!-- -->計算済み (Handled) の値を得ることができたりします。<br><!-- -->(非同期の完了値を実際に受け取ろうとしたタイミングで初めて遅延が発生する)</p></section><section class="aligncenter"><h2>proposal-eventual-send</h2><p>別途仕様の提案が以下に上がっているものとなります。</p><p><a href="https://github.com/tc39-transfer/proposal-eventual-send">tc39-transfer/proposal-eventual-send</a></p></section><section class="aligncenter"><h2><code>HandledPromise</code> の概要</h2><p>実際に Promise Pipelining を実現するために<br><code>HandledPromise</code> コンストラクタが追加されます。</p></section><section class="aligncenter"><p>まず注目するのは <code>HandledPromise</code> コンストラクタが持つ Static Method。<br><!-- -->仕様に上がっている Static Method とそれらがどのような挙動を取るかの一覧です。</p></section><section class="aligncenter"><pre><code class="language-javascript">HandledPromise.get(p, prop);
// -&gt; p.then(t =&gt; t[prop])

HandledPromise.has(p, prop);
// -&gt; p.then(t =&gt; prop in t)

HandledPromise.set(p, prop, value);
// -&gt; p.then(t =&gt; (t[prop] = value))

HandledPromise.delete(p, prop);
// -&gt; p.then(t =&gt; delete t[prop])

HandledPromise.applyFunction(p, args);
// -&gt; p.then(t =&gt; t(...args))

HandledPromise.applyMethod(p, prop, args);
// -&gt; p.then(t =&gt; t[prop](...args))
</code></pre></section><section class="aligncenter"><p>基本的な操作に加えて、非同期処理の結果を必要としない場合に<br><!-- -->コストを低減させるための <code>SendOnly</code> という<br><!-- -->バリエーションも提案に含まれています。</p><pre><code class="language-javascript">HandledPromise.getSendOnly(p, prop);
HandledPromise.hasSendOnly(p, prop);
HandledPromise.setSendOnly(p, prop, value);
HandledPromise.deleteSendOnly(p, prop);
HandledPromise.applyFunctionSendOnly(p, args);
HandledPromise.applyMethodSendOnly(p, prop, args);
</code></pre></section><section class="aligncenter"><p><code>HandledPromise</code> コンストラクタを初期化した場合、<br><code>Promise.prototype</code> と同様の結果を受け取ることになります。</p><p><code>HandledPromise.prototype</code> に対しては<br><!-- -->Static Method と同じように<br><code>get</code>、<code>has</code> などの <strong>トラップ</strong> を実装することが可能です。</p></section><section class="aligncenter"><h2>本題</h2><p>冒頭で紹介した通り、<br><!-- -->Wavy Dot は Promise Pipelining を実現する <a href="https://github.com/Agoric/proposal-eventual-send">proposal-eventual-send</a> (<code>HandledPromise</code>) を<br><!-- -->フォローアップするための構文仕様です。</p></section><section class="aligncenter"><h2>構文</h2><p>Wavy Dot は <a href="https://tc39.es/proposal-optional-chaining/">Optional Chaining</a> や <code>.</code> と<br><!-- -->同じ優先順位を持つ中置演算子で <code>~.</code> と表現します。</p><table><thead><tr><th align="left">構文</th><th align="left">内部メソッド</th></tr></thead><tbody><tr><td align="left"><code>p ~. name</code></td><td align="left"><code>p.[[GetSend]](&#x27;name&#x27;)</code></td></tr><tr><td align="left"><code>p ~. name = value</code></td><td align="left"><code>p.[[SetSend]](&#x27;name&#x27;, value)</code></td></tr><tr><td align="left"><code>delete p ~. name</code></td><td align="left"><code>p.[[DeleteSend]](&#x27;name&#x27;)</code></td></tr><tr><td align="left"><code>p ~. (...args)</code></td><td align="left"><code>p.[[ApplySend]](args)</code></td></tr><tr><td align="left"><code>p ~. name(...args)</code></td><td align="left"><code>p.[[ApplyMethodSend]](&#x27;name&#x27;, args)</code></td></tr><tr><td align="left"><code>p ~. [prop]</code></td><td align="left"><code>p.[[GetSend]](prop)</code></td></tr><tr><td align="left"><code>p ~. [prop] = value</code></td><td align="left"><code>p.[[SetSend]](prop, value)</code></td></tr><tr><td align="left"><code>delete p ~. [prop]</code></td><td align="left"><code>p.[[DeleteSend]](prop)</code></td></tr><tr><td align="left"><code>p ~. [prop](...args)</code></td><td align="left"><code>p.[[ApplyMethodSend]](prop, args)</code></td></tr></tbody></table></section><section class="aligncenter"><p>式の値が明らかに無視される構文コンテキストにおいては<br><!-- -->内部で各メソッドに対応した <code>SendOnly</code> を使用します。</p></section><section class="aligncenter"><h2>Prototype</h2><p>用意されている <a href="https://babeljs.io/repl/build/11698/#?babili=false&amp;browsers=&amp;build=&amp;builtIns=false&amp;spec=false&amp;loose=false&amp;code_lz=B4PwdADgFAngNAAgF6II4EoBQowG0CWAurIkljicueFFgGYDcmmd24EbeRnECAvAgBunAoX5DMAEwCmAG2kAXaQhwcZ8pSvCjmOTAgQcA9EYQA5APYIAhgFcFFgLbWF-AMYIAztMfuLsiwA7BHxA7wAnVyCwXQN9BCMAKgQ6CytE03ZME3MrOwdnVw9vXzd_IJCw6Uj8aMwgA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=es2015%2Creact%2Cstage-2&amp;prettier=false&amp;targets=&amp;version=7.6.2%2Bpr.10115&amp;externalPlugins=babel-plugin-syntax-eventual-send%407.6.2">Babel playground</a> が分かりやすかったため幾つか抜粋。</p></section><section class="aligncenter"><pre><code class="language-javascript">x~.p
</code></pre><p>👇</p><pre><code class="language-javascript">HandledPromise.get(x, &quot;p&quot;);
</code></pre></section><section class="aligncenter"><pre><code class="language-javascript">x~.p = v
</code></pre><p>👇</p><pre><code class="language-javascript">HandledPromise.set(x, &quot;p&quot;, v);
</code></pre></section><section class="aligncenter"><pre><code class="language-javascript">delete x~.p
</code></pre><p>👇</p><pre><code class="language-javascript">HandledPromise.delete(x, &quot;p&quot;);
</code></pre></section><section class="aligncenter"><pre><code class="language-javascript">x~.p(y, z, q)
</code></pre><p>👇</p><pre><code class="language-javascript">HandledPromise.applyMethod(x, &quot;p&quot;, [y, z, q]);
</code></pre></section><section class="aligncenter"><pre><code class="language-javascript">x~.()
</code></pre><p>👇</p><pre><code class="language-javascript">HandledPromise.apply(x, []);
</code></pre></section><section class="aligncenter"><h2>所感</h2><ul><li>仕様内に TypeScript との競合を避けるための一文がある</li><li>Wavy Dot 自体の仕様についての紹介ではなくて、ほとんどが <code>HandledPromise</code> の話になってしまいました</li><li><code>HandledPromise</code> のプリミティブな API を使って、便利で高速なライブラリ等が出てくるような気がして胸アツでした</li></ul></section><section class="aligncenter"><h2>Related Proposal &amp; Discussion</h2><ul><li><a href="https://babeljs.io/repl/build/11698/#?babili=false&amp;browsers=&amp;build=&amp;builtIns=false&amp;spec=false&amp;loose=false&amp;code_lz=B4PwdADgFAngNAAgF6II4EoBQowG0CWAurIkljicueFFgGYDcmmd24EbeRnECAvAgBunAoX5DMAEwCmAG2kAXaQhwcZ8pSvCjmOTAgQcA9EYQA5APYIAhgFcFFgLbWF-AMYIAztMfuLsiwA7BHxA7wAnVyCwXQN9BCMAKgQ6CytE03ZME3MrOwdnVw9vXzd_IJCw6Uj8aMwgA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=es2015%2Creact%2Cstage-2&amp;prettier=false&amp;targets=&amp;version=7.6.2%2Bpr.10115&amp;externalPlugins=babel-plugin-syntax-eventual-send%407.6.2">Babel playground</a></li><li><a href="https://github.com/tc39-transfer/proposal-eventual-send">tc39-transfer/proposal-eventual-send: TC39 Eventual Send proposal</a></li><li><a href="https://www.youtube.com/watch?v=UXR0O-CufTk&amp;list=PLzDw4TTug5O0ywHrOz4VevVTYr6Kj_KtW">Eventual Send: JS Support for Promise Pipelining - YouTube</a></li></ul></section><section class="aligncenter title"><h1>Thank you 🐶 !</h1></section></article></div><script type="text/javascript" src="runtime.2db2933dc188e629c868.bundle.js"></script><script type="text/javascript" src="vendor.6.5ad5f6b238180a494f21.bundle.js"></script><script type="text/javascript" src="main.3.0295305ca86053c4e9a8.bundle.js"></script></body></html>